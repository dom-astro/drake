<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Méthode des vitesses radiales - Décalage Doppler</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            text-align: center;
            color: #4a9eff;
            margin-bottom: 30px;
        }
        
        .container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .animation-panel {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(74, 158, 255, 0.2);
        }
        
        .graph-panel {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(74, 158, 255, 0.2);
        }
        
        canvas {
            border: 2px solid #333;
            border-radius: 8px;
            background: #000;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #3a7edf;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .info-box {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            max-width: 800px;
            text-align: center;
        }
        
        .velocity-display {
            font-size: 24px;
            font-weight: bold;
            color: #4a9eff;
            margin: 10px 0;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .slider-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        input[type="range"] {
            width: 150px;
        }
        
        .phase-indicator {
            margin-top: 10px;
            font-size: 18px;
            color: #ffaa4a;
        }
    </style>
</head>
<body>
    <h1>Méthode des vitesses radiales - Décalage Doppler</h1>
    
    <div class="container">
        <div class="animation-panel">
            <h3>Animation du système étoile-planète</h3>
            <canvas id="orbitCanvas" width="400" height="400"></canvas>
            <div class="velocity-display" id="velocityDisplay">Vitesse radiale: 0.0 m/s</div>
            <div class="phase-indicator" id="phaseIndicator">Phase: Approche</div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffff00;"></div>
                    <span>Étoile</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4a9eff;"></div>
                    <span>Planète</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff4444;"></div>
                    <span>Centre de masse</span>
                </div>
            </div>
        </div>
        
        <div class="graph-panel">
            <h3>Courbe de vitesse radiale</h3>
            <canvas id="graphCanvas" width="400" height="300"></canvas>
            <div class="controls">
                <button id="playPause">Pause</button>
                <button id="reset">Reset</button>
                <div class="slider-container">
                    <label>Masse planète</label>
                    <input type="range" id="massSlider" min="1" max="10" value="5" step="0.5">
                    <span id="massValue">5.0 M_J</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="info-box">
        <h3>Principe de la méthode</h3>
        <p>L'étoile et la planète orbitent autour de leur centre de masse commun. Cette oscillation de l'étoile 
        provoque un décalage Doppler dans sa lumière : <strong style="color: #4a9eff;">bleu quand elle s'approche</strong>, 
        <strong style="color: #ff4444;">rouge quand elle s'éloigne</strong>. La courbe de vitesse radiale révèle 
        la présence de la planète et permet de déterminer sa masse et sa période orbitale.</p>
    </div>

    <script>
        const orbitCanvas = document.getElementById('orbitCanvas');
        const graphCanvas = document.getElementById('graphCanvas');
        const orbitCtx = orbitCanvas.getContext('2d');
        const graphCtx = graphCanvas.getContext('2d');
        
        let time = 0;
        let isPlaying = true;
        let velocityHistory = [];
        let timeHistory = [];
        let maxHistoryLength = 200;
        
        // Paramètres physiques
        let planetMass = 5.0; // En masses de Jupiter
        const stellarMass = 1.0; // Masse solaire
        const orbitalRadius = 100; // pixels
        const period = 200; // frames pour une orbite complète
        
        // Éléments DOM
        const playPauseBtn = document.getElementById('playPause');
        const resetBtn = document.getElementById('reset');
        const massSlider = document.getElementById('massSlider');
        const massValue = document.getElementById('massValue');
        const velocityDisplay = document.getElementById('velocityDisplay');
        const phaseIndicator = document.getElementById('phaseIndicator');
        
        // Calcul du rayon de l'oscillation stellaire
        function getStellarOscillationRadius() {
            // Rayon d'oscillation basé sur le rapport des masses
            return orbitalRadius * (planetMass * 0.001) / (stellarMass + planetMass * 0.001);
        }
        
        // Calcul de la vitesse radiale
        function getRadialVelocity(angle) {
            const maxVelocity = 50 * Math.sqrt(planetMass); // Vitesse max en m/s
            return maxVelocity * Math.sin(angle);
        }
        
        function drawOrbitAnimation() {
            orbitCtx.clearRect(0, 0, orbitCanvas.width, orbitCanvas.height);
            
            const centerX = orbitCanvas.width / 2;
            const centerY = orbitCanvas.height / 2;
            const angle = (time * 2 * Math.PI) / period;
            
            // Position de la planète
            const planetX = centerX + orbitalRadius * Math.cos(angle);
            const planetY = centerY + orbitalRadius * Math.sin(angle);
            
            // Position de l'étoile (oscillation)
            const stellarRadius = getStellarOscillationRadius();
            const stellarX = centerX - stellarRadius * Math.cos(angle);
            const stellarY = centerY - stellarRadius * Math.sin(angle);
            
            // Centre de masse
            orbitCtx.fillStyle = '#ff4444';
            orbitCtx.beginPath();
            orbitCtx.arc(centerX, centerY, 3, 0, 2 * Math.PI);
            orbitCtx.fill();
            
            // Orbite de la planète
            orbitCtx.strokeStyle = '#444';
            orbitCtx.lineWidth = 1;
            orbitCtx.beginPath();
            orbitCtx.arc(centerX, centerY, orbitalRadius, 0, 2 * Math.PI);
            orbitCtx.stroke();
            
            // Orbite de l'étoile
            orbitCtx.strokeStyle = '#666';
            orbitCtx.beginPath();
            orbitCtx.arc(centerX, centerY, stellarRadius, 0, 2 * Math.PI);
            orbitCtx.stroke();
            
            // Ligne vers l'observateur
            orbitCtx.strokeStyle = '#888';
            orbitCtx.lineWidth = 2;
            orbitCtx.beginPath();
            orbitCtx.moveTo(stellarX, stellarY);
            orbitCtx.lineTo(stellarX, 50);
            orbitCtx.stroke();
            
            // Flèche vers observateur
            orbitCtx.fillStyle = '#888';
            orbitCtx.beginPath();
            orbitCtx.moveTo(stellarX - 5, 60);
            orbitCtx.lineTo(stellarX + 5, 60);
            orbitCtx.lineTo(stellarX, 50);
            orbitCtx.fill();
            
            // Texte "Vers l'observateur"
            orbitCtx.fillStyle = '#888';
            orbitCtx.font = '12px Arial';
            orbitCtx.textAlign = 'center';
            orbitCtx.fillText('Vers l\'observateur', stellarX, 35);
            
            // Planète
            orbitCtx.fillStyle = '#4a9eff';
            orbitCtx.beginPath();
            orbitCtx.arc(planetX, planetY, 8, 0, 2 * Math.PI);
            orbitCtx.fill();
            
            // Étoile avec couleur Doppler
            const velocity = getRadialVelocity(angle);
            let stellarColor;
            if (velocity > 0) {
                // S'éloigne - décalage vers le rouge
                const intensity = Math.min(Math.abs(velocity) / 50, 1);
                stellarColor = `rgb(255, ${255 - intensity * 100}, ${255 - intensity * 100})`;
            } else {
                // S'approche - décalage vers le bleu
                const intensity = Math.min(Math.abs(velocity) / 50, 1);
                stellarColor = `rgb(${255 - intensity * 100}, ${255 - intensity * 100}, 255)`;
            }
            
            orbitCtx.fillStyle = stellarColor;
            orbitCtx.beginPath();
            orbitCtx.arc(stellarX, stellarY, 12, 0, 2 * Math.PI);
            orbitCtx.fill();
            
            // Bordure de l'étoile
            orbitCtx.strokeStyle = '#ffff00';
            orbitCtx.lineWidth = 2;
            orbitCtx.stroke();
            
            // Mise à jour des affichages
            velocityDisplay.textContent = `Vitesse radiale: ${velocity.toFixed(1)} m/s`;
            
            if (velocity > 5) {
                phaseIndicator.textContent = 'Phase: Éloignement (décalage rouge)';
                phaseIndicator.style.color = '#ff4444';
            } else if (velocity < -5) {
                phaseIndicator.textContent = 'Phase: Approche (décalage bleu)';
                phaseIndicator.style.color = '#4a9eff';
            } else {
                phaseIndicator.textContent = 'Phase: Vitesse tangentielle';
                phaseIndicator.style.color = '#ffaa4a';
            }
        }
        
        function drawGraph() {
            graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            // Axes
            graphCtx.strokeStyle = '#666';
            graphCtx.lineWidth = 1;
            
            // Axe X (temps)
            graphCtx.beginPath();
            graphCtx.moveTo(40, graphCanvas.height - 40);
            graphCtx.lineTo(graphCanvas.width - 20, graphCanvas.height - 40);
            graphCtx.stroke();
            
            // Axe Y (vitesse)
            graphCtx.beginPath();
            graphCtx.moveTo(40, 20);
            graphCtx.lineTo(40, graphCanvas.height - 40);
            graphCtx.stroke();
            
            // Labels
            graphCtx.fillStyle = '#ccc';
            graphCtx.font = '12px Arial';
            graphCtx.textAlign = 'center';
            graphCtx.fillText('Temps', graphCanvas.width / 2, graphCanvas.height - 10);
            
            graphCtx.save();
            graphCtx.translate(15, graphCanvas.height / 2);
            graphCtx.rotate(-Math.PI / 2);
            graphCtx.fillText('Vitesse radiale (m/s)', 0, 0);
            graphCtx.restore();
            
            // Graduations Y
            const maxVel = 50 * Math.sqrt(planetMass);
            const yCenter = (graphCanvas.height - 40) / 2;
            
            for (let i = -1; i <= 1; i += 0.5) {
                const y = yCenter - (i * yCenter * 0.8);
                const vel = i * maxVel;
                
                graphCtx.strokeStyle = '#444';
                graphCtx.beginPath();
                graphCtx.moveTo(35, y);
                graphCtx.lineTo(45, y);
                graphCtx.stroke();
                
                graphCtx.fillStyle = '#ccc';
                graphCtx.textAlign = 'right';
                graphCtx.fillText(vel.toFixed(0), 32, y + 4);
            }
            
            // Ligne zéro
            graphCtx.strokeStyle = '#888';
            graphCtx.lineWidth = 1;
            graphCtx.beginPath();
            graphCtx.moveTo(40, yCenter);
            graphCtx.lineTo(graphCanvas.width - 20, yCenter);
            graphCtx.stroke();
            
            // Courbe de vitesse avec couleurs Doppler
            if (velocityHistory.length > 1) {
                graphCtx.lineWidth = 3;
                
                for (let i = 0; i < velocityHistory.length - 1; i++) {
                    const x1 = 40 + (i / maxHistoryLength) * (graphCanvas.width - 60);
                    const y1 = yCenter - (velocityHistory[i] / maxVel) * yCenter * 0.8;
                    const x2 = 40 + ((i + 1) / maxHistoryLength) * (graphCanvas.width - 60);
                    const y2 = yCenter - (velocityHistory[i + 1] / maxVel) * yCenter * 0.8;
                    
                    // Couleur basée sur la vitesse radiale avec dégradé bleu-blanc-rouge
                    const velocity = velocityHistory[i];
                    const normalizedVel = velocity / maxVel; // -1 à +1
                    
                    // Conversion en valeur 0-1 pour le dégradé
                    const gradientValue = (normalizedVel + 1) / 2; // 0 = bleu foncé, 0.5 = blanc, 1 = rouge foncé
                    
                    let r, g, b;
                    
                    if (gradientValue < 0.5) {
                        // Transition bleu foncé -> blanc
                        const t = gradientValue * 2; // 0 à 1
                        r = Math.floor(0 + t * 255);      // 0 -> 255
                        g = Math.floor(0 + t * 255);      // 0 -> 255
                        b = Math.floor(139 + t * 116);    // 139 -> 255 (bleu foncé vers blanc)
                    } else {
                        // Transition blanc -> rouge foncé
                        const t = (gradientValue - 0.5) * 2; // 0 à 1
                        r = Math.floor(255 - t * 116);    // 255 -> 139 (blanc vers rouge foncé)
                        g = Math.floor(255 - t * 255);    // 255 -> 0
                        b = Math.floor(255 - t * 255);    // 255 -> 0
                    }
                    
                    graphCtx.strokeStyle = `rgb(${r}, ${g}, ${b})`;
                    
                    graphCtx.beginPath();
                    graphCtx.moveTo(x1, y1);
                    graphCtx.lineTo(x2, y2);
                    graphCtx.stroke();
                }
                
                // Point actuel
                const currentX = 40 + ((velocityHistory.length - 1) / maxHistoryLength) * (graphCanvas.width - 60);
                const currentY = yCenter - (velocityHistory[velocityHistory.length - 1] / maxVel) * yCenter * 0.8;
                
                graphCtx.fillStyle = '#ffaa4a';
                graphCtx.beginPath();
                graphCtx.arc(currentX, currentY, 5, 0, 2 * Math.PI);
                graphCtx.fill();
            }
        }
        
        function animate() {
            if (isPlaying) {
                const angle = (time * 2 * Math.PI) / period;
                const velocity = getRadialVelocity(angle);
                
                velocityHistory.push(velocity);
                timeHistory.push(time);
                
                if (velocityHistory.length > maxHistoryLength) {
                    velocityHistory.shift();
                    timeHistory.shift();
                }
                
                time++;
            }
            
            drawOrbitAnimation();
            drawGraph();
            
            requestAnimationFrame(animate);
        }
        
        // Contrôles
        playPauseBtn.addEventListener('click', () => {
            isPlaying = !isPlaying;
            playPauseBtn.textContent = isPlaying ? 'Pause' : 'Play';
        });
        
        resetBtn.addEventListener('click', () => {
            time = 0;
            velocityHistory = [];
            timeHistory = [];
        });
        
        massSlider.addEventListener('input', (e) => {
            planetMass = parseFloat(e.target.value);
            massValue.textContent = `${planetMass.toFixed(1)} M_J`;
        });
        
        // Démarrage
        animate();
    </script>
</body>
</html>